# Memory Management Integration Tests
#
# Simple tests for @mem decorator - focused on testing the parsing and strategy selection.
# These tests avoid known codegen limitations.

# =============================================================================
# INLINE TYPE TESTS
# =============================================================================

@mem(inline=True)
class Vec2:
    x: f32
    y: f32

@mem(inline=True) 
class Color:
    r: u8
    g: u8
    b: u8
    a: u8

# =============================================================================
# REGION ALLOCATION TESTS
# =============================================================================

@mem(region=True)
def process_local_data(values: Vec[i32]) -> i32:
    """Function with region allocation hint - values don't escape"""
    total: i32 = 0
    for v in values:
        total = total + v
    return total

# =============================================================================
# RAW CONTROL TESTS
# =============================================================================

@mem(raw=True)
def raw_add(a: i32, b: i32) -> i32:
    """Function with raw memory control - no auto-wrapping"""
    return a + b

# =============================================================================
# COMBINED USAGE TESTS
# =============================================================================

@mem(inline=True)
class Point:
    x: i32
    y: i32

@mem(region=True)
def distance_squared(p1_x: i32, p1_y: i32, p2_x: i32, p2_y: i32) -> i32:
    """Calculate distance squared using primitive inline types"""
    dx: i32 = p2_x - p1_x
    dy: i32 = p2_y - p1_y
    return dx * dx + dy * dy

# =============================================================================
# MAIN - Simple verification
# =============================================================================

def main():
    print("=== Memory Integration Tests ===")
    
    # Test region function with primitive inputs
    result: i32 = process_local_data([1, 2, 3, 4, 5])
    print("process_local_data result: ")
    print(result.to_string())
    
    # Test raw function
    raw_result: i32 = raw_add(10, 20)
    print("raw_add result: ")
    print(raw_result.to_string())
    
    # Test distance calculation
    dist: i32 = distance_squared(0, 0, 3, 4)
    print("distance_squared result: ")
    print(dist.to_string())
    
    print("=== Tests Complete ===")
