
from rust.std.fs import read_dir
import std.path

def test_dynamic_macro():
    # Should transpile to: let entries = quiche::call!(read_dir, String::from("."));
    print("--- test_dynamic_macro: printing all files in . ---")
    for entry in read_dir("."):
        match entry:
            case Ok(entry):
                path = entry.path()
                # Bind to variable to prolong lifetime of OsString
                fname = entry.file_name()
                # Use into_owned() on the Cow result (treated as Any)
                print(fname.to_string_lossy())
            case Err(err):
                print(err)
    print("--- test_dynamic_macro: done ---")
    
def test_extern_binding():
    # Should use std::vec::Vec wrapped in Rc for mutation
    v = List[i64].new()
    v.push(10)
    v.push(20)
    print(v.len())
    assert(v.len() == 2)

test_dynamic_macro()
test_extern_binding()
